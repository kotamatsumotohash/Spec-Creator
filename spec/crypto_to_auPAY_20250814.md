**承認: Manager（プロダクトマネージャー）**  
承認日: 2025年8月14日

---

# auPAY暗号資産チャージ機能 要件定義書

## 1. 概要
Baseチェーン上のBTCまたはUSDCを消費してauPAY残高にチャージできる機能。KYC済みユーザーのみ利用可能で、月間50,000円までの制限あり。

## 2. ビジネスゴール
Ponta交換機能やスワップ機能と組み合わせることで、日本円入金・資産運用・暗号資産出金を一つのウォレット内で完結できる他社にない価値を提供する。

### KPI
| 指標 | 定義 | 目標（仮） | 計測方法 |
| --- | --- | --- | --- |
| 月間チャージ金額 | 月次の総チャージ額 | ※仮置き：28M円（既存ポイント交換実績ベース） | 決済システムログ集計 |
| チャージ成功率 | 成功取引/総取引数 | ※仮置き：95%以上 | 取引ログ分析 |
| KYC済みユーザー利用率 | チャージ利用者/KYC済み総数 | ※仮置き：5%以上 | ユーザー行動分析 |
| 平均チャージ単価 | 総チャージ金額/取引数 | ※仮置き：3,000円以上 | 決済データ分析 |

## 3. 想定ユーザーフロー
1. ウォレット画面からチャージボタンをタップ
2. **[KYC未済の場合]** ダイアログ表示→auPAY設定画面へ遷移→KYC完了後に戻る
3. **[月間制限確認]** リアルタイムで月間チャージ累計額をチェック
4. チャージ金額を選択（100/1,000/5,000/10,000円の単位、最大50,000円）
5. 確認画面が表示される（チャージ額、手数料、受取金額、クオート期限）
6. **[処理中]** ローディング表示・キャンセルボタン表示
7. 30秒のクオート有効期限内に確定ボタンを押す
8. **[エラー時]** エラーダイアログ表示→再試行/キャンセル選択
9. チャージ処理実行・完了通知表示
10. auPAY残高に反映・月間累計額を更新

## 4. UI
### 画面1：ウォレット画面
チャージボタンを上部に配置。KYC未済の場合はグレーアウト表示＋タップでKYC誘導ダイアログ。

### 画面2：金額選択画面  
100/1,000/5,000/10,000円の選択ボタンと月間利用可能残額をリアルタイム表示。※仮置き：VoiceOver対応でボタン読み上げ。

### 画面3：確認画面
チャージ額、手数料（2.5%）、実際の受取金額、30秒カウントダウンタイマー、確定ボタンを表示。処理中はローディングスピナー＋キャンセルボタン。

### 画面4：エラー表示画面
※仮置き：「残高不足です」「ネットワークエラーが発生しました」「月間制限を超過しています」等のメッセージ＋再試行ボタン。

## 5. 機能要求
| 優先度 | 項目 | 要求 |
| --- | --- | --- |
| Must | KYC確認・誘導 | auPAYアプリ内でKYC済みでない場合はダイアログ表示・設定画面誘導 |
| Must | リアルタイム制限管理 | 月間50,000円上限をリアルタイム制御・残額表示・超過防止 |
| Must | クオート管理 | 30秒有効期限での価格保証・自動更新・タイムアウト処理 |
| Must | Base BTC/USDC対応 | Baseチェーン上のBTCまたはUSDC決済処理・API連携 |
| Must | 手数料徴収 | 暗号資産価格に2.5%上乗せでの収益確保 |
| Must | エラーハンドリング | 残高不足・期限切れ・ネットワークエラー・制限超過時のダイアログ表示・再試行機能 |
| Must | トランザクション制御 | 決済処理の原子性保証・ロールバック機能 |
| Should | 履歴表示 | チャージ履歴の確認機能 |
| Should | アクセシビリティ | ※仮置き：VoiceOver対応・ハイコントラスト表示・大文字表示対応 |
| Should | 監査ログ | チャージ取引・エラー・制限超過の詳細ログ記録 |
| Could | 通知機能 | チャージ完了プッシュ通知 |
| Won't | 他チェーン対応 | 初期リリース時は対象外 |

※Mustは必須、Shouldができるだけ必要、Couldが優先度低めだが入れたい、Won'tが不要

## 6. 運用
### 運用頻度
※仮置き：24時間365日稼働、定期メンテナンス月1回

### 運用フロー
※仮置き：異常取引の自動検知・アラート、顧客サポート対応（営業時間内）、月間制限リセット処理（月初自動実行）

### 運用コスト
手数料収入：チャージ時の暗号資産価格に2.5%上乗せして収益確保
※仮置き：運用人件費・システム維持費は別途算出

## 7. セキュリティ/コンプライアンス等の要求
- KYC済みユーザーのみ利用可能
- 月間50,000円の利用上限による資金決済法準拠
- 暗号資産価格操作防止のためのクオート機能
- 不正利用監視・検知システム
- auPAYセキュリティ基準への準拠
- ※仮置き：障害者差別解消法対応（アクセシビリティ準拠）
- ※仮置き：API レート制限・DDoS対策

## 8. Devチームへ引き継ぎする未決定事項
| 項目 | 補足 |
| --- | --- |
| Base API連携詳細 | タイムアウト・リトライ・レート制限の具体的仕様 |
| クオートAPI仕様 | 価格更新頻度・精度・障害時フォールバック方式 |
| 決済システム連携 | auPAY残高への反映処理・API仕様・トランザクション境界 |
| 月間制限DB設計 | 分散処理での競合制御・ロック機構の実装方式 |
| 監査ログ項目 | 記録すべきデータ項目・保存期間・アラート条件 |
| アクセシビリティ詳細 | VoiceOver・ハイコントラスト等の具体的実装方法 |

## 9. 今後のTodo（Biz）
- [ ] KPI目標値の詳細設定・承認
- [ ] 運用体制・サポート対応フローの確定  
- [ ] 法務・コンプライアンス最終確認
- [ ] アクセシビリティ要件・ガイドライン策定
- [ ] 監査ログ・メトリクス・アラート設計